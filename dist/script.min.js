(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}const e=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.$=t}var n,a,r;return n=e,r=[{key:"getDocumentNodeId",value:function(t,e){return"textru_document_".concat(t,"_").concat(e)}},{key:"getTitleNodeId",value:function(t){return"textru_title_".concat(t)}}],(a=[{key:"viewDocuments",value:function(t,n){var a=this,r=this.$("#".concat(e.getTitleNodeId(t))).find("table");if(r.length)return r.toggle(),void r.parents(".order_row").toggleClass("opened");var i=n.parent().find("span.spinner");if(!(i.length>0)){(i=this.$('<span class="spinner is-active"></span>')).insertAfter(n);var o={action:"textru_view_documents",orderId:t};this.$.post(ajaxurl,o,(function(t){var n=(t=JSON.parse(t)).list,r=t.orderId,o=a.$("<table>");if(0===n.length){var d=a.$("<tr>").append("<td>").append("<div>").find("div").addClass("update-nag notice notice-warning").text("У этого заказа нет документов");o.append(d)}else n.forEach((function(t){var n=a.$("<a>");null===t.url?n.text("Сохранить в черновики").addClass("button button-primary clearfix").on("click",(function(){return a.publishDocument(r,t.number),!1})):n=a.getDocumentLink(t.url);var i=a.$("<tr>").attr("id",e.getDocumentNodeId(r,t.number)).append(a.$("<td>").text(t.number)).append(a.$("<td>").append(a.$("<h4>").text(t.title)).append(a.$("<p><em></em></p>").find("em").text(t.createdAt)).append(a.$("<p>").text(t.text)).append(n));o.append(i)}));a.$("#".concat(e.getTitleNodeId(r))).append(o).parents(".order_row").toggleClass("opened"),i.remove()}))}}},{key:"makeTable",value:function(){var t=this,n=[];return null===this.orders||this.orders.forEach((function(a){var r=t.$('<a href="#"><span class="show_documents">Посмотреть документы</span><span class="hide_documents">Скрыть документы</span></a>');r.on("click",(function(){return t.viewDocuments(a.id,r),!1}));var i=t.$("<tr>").addClass("order_row").append(t.$("<td>").text(a.id)).append(t.$("<td>").text(a.title).addClass("title").attr("id",e.getTitleNodeId(a.id))).append(t.$("<td>").text(a.finishedAt)).append(t.$('<td><div class="row-actions"><span></span></div></td>').find("span").append(r).end());n.push(i)})),n}},{key:"makePaginator",value:function(t){var e=this,n=this.$("<span>"),a=Math.ceil(this.pages/20);this.$("#textru_paginator").toggle(a>0);for(var r=function(a){var r=e.$('<a href="#">').text(a).on("click",(function(){return e.loadPage(a),!1}));a===t&&r.addClass("active"),a%20==0&&n.append("<br>"),n.append(r)},i=1;i<=a;i+=1)r(i);return n}},{key:"loadPage",value:function(t){var e=this,n={action:"textru_load_posts",page:t};this.$.post(ajaxurl,n,(function(n){if(n=JSON.parse(n),e.pages=n.totalCount||null,e.orders=n.list||null,null!==e.orders){var a=e.makeTable(),r=e.makePaginator(t);e.$("#textru_table tbody").empty().append(a),e.$("#textru_paginator span").empty().append(r)}var i=null===e.orders||0===e.orders.length;e.$("#textru_table").toggle(!i),e.$("#textru_empty_table").toggle(i)}))}},{key:"publishDocument",value:function(t,n){var a=this,r={action:"textru_publish_document",orderId:t,number:n},i=this.$("#".concat(e.getDocumentNodeId(t,n))).find("td").last(),o=i.find("span.spinner");if(o.length>0)return!1;o=this.$('<span class="spinner is-active"></span>');var d=i.find("a");return i.append(o),d.addClass("disabled"),this.$.post(ajaxurl,r,(function(t){var e=JSON.parse(t).url;if(void 0!==e){var n=a.getDocumentLink(e);d.remove().end().append(n),o.remove()}})),!1}},{key:"getDocumentLink",value:function(t){return this.$("<a>").text("Сохранено: ".concat(t)).attr("href",t).attr("target","_blank")}}])&&t(n.prototype,a),r&&t(n,r),e}();jQuery((function(t){void 0!==ajaxurl&&1===t("#textru_token").length&&new e(t).loadPage(1)}))})();